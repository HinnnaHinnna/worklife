<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>수한무의 수명 (모바일 대응)</title>
  <link rel="icon" href="path/to/favicon.ico" type="image/x-icon">

  <style>
    @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard-dynamic-subset.css");
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100;1,100&display=swap');

    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Pretendard', sans-serif;
      text-align: center;
      background-color: #f5f5f5;
    }

    body {
      margin: 20px 60px;
      overflow: hidden;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(50, 1fr);
      grid-template-rows: repeat(7, 1fr);
      gap: 0;
    }

    .cell {
      height: 28px;
      background-color: rgb(102, 255, 102);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: black;
      font-weight: 600;
    }

    #timer {
      font-family: 'Roboto Mono', monospace;
      font-size: 100px;
      margin-bottom: 20px;
    }

    @media screen and (max-width: 640px) {
      body {
        margin: 10px;
      }

      .grid {
        grid-template-columns: repeat(30, 1fr);
        grid-template-rows: repeat(8, 1fr);
      }

      .cell {
        height: 22px;
        font-size: 10px;
      }

      #timer {
        font-size: 70px;
        margin-bottom: 10px;
      }
    }

    #warning {
      color: red;
      font-size: 14px;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div id="timer">0</div>
  <div id="warning"></div>
  <div class="grid" id="grid"></div>

  <script>
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    if (isIOS) {
      document.getElementById('warning').textContent = "⚠️ iOS에서는 음성인식이 제한될 수 있습니다.";
    }

    const ROWCOUNT = 7;
    const COLCOUNT = window.innerWidth <= 640 ? 30 : 50;
    const grid = document.getElementById('grid');
    const charArrayIdx = new Array(ROWCOUNT * COLCOUNT).fill(0);
    let whiteCellCount = 0;
    let totalCharCount = 0;
    let isFirstClick = true;

    function initializeGrid() {
      grid.innerHTML = '';
      for (let i = 0; i < ROWCOUNT * COLCOUNT; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        grid.appendChild(cell);
      }
    }

    initializeGrid();

    // 샘플 텍스트 랜덤 배치 (간단화)
    const sample = "수한무 거북이와 두루미 은혼";
    for (let i = 0; i < sample.length; i++) {
      const idx = Math.floor(Math.random() * (ROWCOUNT * COLCOUNT));
      const cell = grid.children[idx];
      cell.textContent = sample[i];
      charArrayIdx[idx] = 1;
      totalCharCount++;
    }

    const baseColor = 'rgb(102,255,102)';
    const midColor = 'white';
    const lastColor = 'blue';

    function changeColor(cell) {
      cell.style.backgroundColor = midColor;
      cell.style.color = midColor;
      setTimeout(() => {
        cell.style.backgroundColor = lastColor;
        cell.style.color = lastColor;
      }, 300);
    }

    function handleCellClick(cell) {
      const idx = Array.from(grid.children).indexOf(cell);
      if (charArrayIdx[idx] === 1) {
        changeColor(cell);
        charArrayIdx[idx]++;
        whiteCellCount++;
      }
    }

    // 클릭 + 모바일 터치 이벤트
    grid.addEventListener('click', (e) => handleCellClick(e.target));
    grid.addEventListener('touchstart', (e) => handleCellClick(e.target), { passive: true });

    // 타이머
    let seconds = 0;
    const timer = document.getElementById('timer');
    setInterval(() => {
      seconds++;
      timer.textContent = seconds;
    }, 1000);

    // 음성 인식 시작
    if ('webkitSpeechRecognition' in window) {
      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'ko-KR';
      recognition.continuous = true;
      recognition.interimResults = false;

      recognition.onresult = function (event) {
        const text = event.results[event.resultIndex][0].transcript;
        [...text].forEach(char => {
          for (let i = 0; i < grid.children.length; i++) {
            const cell = grid.children[i];
            if (cell.textContent === char && charArrayIdx[i] === 1) {
              changeColor(cell);
              charArrayIdx[i]++;
              whiteCellCount++;
            }
          }
        });
      };

      recognition.onerror = (e) => {
        console.warn("Speech error:", e.error);
      };

      recognition.onend = () => {
        recognition.start();
      };

      recognition.start();
    } else {
      document.getElementById('warning').textContent += " 브라우저가 음성인식을 지원하지 않습니다.";
    }
  </script>
</body>

</html>
